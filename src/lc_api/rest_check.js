(function(NS){ async function fetchCheck(id,{tries=7}={}){ const url=`${location.origin}/submissions/detail/${id}/check/`; let delay=350; for(let i=0;i<tries;i++){ try{ const res=await fetch(url,{credentials:'include'}); if(!res.ok) throw new Error('HTTP '+res.status); const j=await res.json(); const state=j.state||j.stateCode||''; const out={ runtimeBeats: Number(j.runtime_percentile ?? j.runtimePercentile) || null, memoryBeats: Number(j.memory_percentile ?? j.memoryPercentile) || null, runtimeStr: j.status_runtime || j.runtimeDisplay || '', memoryStr: j.status_memory || j.memoryDisplay || '' }; if(/success|finished|done/i.test(String(state))) return out; if(out.runtimeBeats!=null || out.memoryBeats!=null || out.runtimeStr || out.memoryStr) return out; }catch(e){} await new Promise(r=>setTimeout(r, delay)); delay=Math.min(1800, Math.round(delay*1.5)); } return {}; } NS.lc_api=NS.lc_api||{}; NS.lc_api.restCheck={ fetch: fetchCheck }; })(window.LCMD);
